___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "rokupx",
  "version": 1,
  "securityGroups": [
    "NON_GOOGLE_SCRIPTS"
  ],
  "displayName": "Roku Pixel",
  "categories": [
    "ADVERTISING",
    "ANALYTICS",
    "ATTRIBUTION",
    "CONVERSIONS",
    "MARKETING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Roku",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Roku Pixel helps advertisers measure the cross-device impact of advertising campaigns.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "Configuration",
    "displayName": "Roku Pixel Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "event_group_id",
        "displayName": "Event Group ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "You can find your Event Group ID in the Events tab of Roku Ads Manager."
      },
      {
        "type": "SELECT",
        "name": "event_type",
        "displayName": "Event Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "PAGE_VIEW",
            "displayValue": "Page views"
          },
          {
            "value": "ACHEIVE_LEVEL",
            "displayValue": "Achieve level"
          },
          {
            "value": "ADD_PAYMENT_INFO",
            "displayValue": "Add payment info"
          },
          {
            "value": "ADD_TO_CART",
            "displayValue": "Add to cart"
          },
          {
            "value": "ADD_TO_WISHLIST",
            "displayValue": "Add to wishlist"
          },
          {
            "value": "APP_INSTALL",
            "displayValue": "App installs"
          },
          {
            "value": "COMPLETE_REGISTRATION",
            "displayValue": "Complete registration"
          },
          {
            "value": "CONTACT",
            "displayValue": "Contact"
          },
          {
            "value": "CUSTOMIZE_PRODUCT",
            "displayValue": "Customize product"
          },
          {
            "value": "DONATE",
            "displayValue": "Donations"
          },
          {
            "value": "DOWNLOAD",
            "displayValue": "Downloads"
          },
          {
            "value": "FIND_LOCATIONS",
            "displayValue": "Find location"
          },
          {
            "value": "INITIATE_CHECKOUT",
            "displayValue": "Initiate checkout"
          },
          {
            "value": "LEAD",
            "displayValue": "Lead"
          },
          {
            "value": "PURCHASE",
            "displayValue": "Purchases"
          },
          {
            "value": "VIEW_CONTENT",
            "displayValue": "View content"
          },
          {
            "value": "UNLOCK_ACHIEVEMENT",
            "displayValue": "Unlock achievement"
          },
          {
            "value": "SUBSCRIPTION_RENEWAL",
            "displayValue": "Subscription renewal"
          },
          {
            "value": "SUBSCRIPTION_CANCELLATION",
            "displayValue": "Subscription cancellation"
          },
          {
            "value": "SUBSCRIBE",
            "displayValue": "Subscribe"
          },
          {
            "value": "SIGN_UP",
            "displayValue": "Sign-ups"
          },
          {
            "value": "SEARCH",
            "displayValue": "Search"
          },
          {
            "value": "SCHEDULE",
            "displayValue": "Schedule"
          },
          {
            "value": "START_TRIAL",
            "displayValue": "Start trial"
          }
        ],
        "simpleValueType": true
      }
    ],
    "help": "\u003ca href\u003d\"https://help.ads.roku.com/en/articles/11321752\" target\u003d\"_blank\"\u003eLearn more\u003c/a\u003e about using the Roku Pixel with Google Tag Manager."
  },
  {
    "type": "GROUP",
    "name": "Event Metadata",
    "displayName": "Event Metadata",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "PARAM_TABLE",
        "name": "event",
        "displayName": "Passing custom parameters to Roku enables more precise optimization and detailed reporting.",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "key",
              "displayName": "Key",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "value",
              "displayName": "Value",
              "simpleValueType": true
            },
            "isUnique": false
          }
        ],
        "help": "\u003ca href\u003d\"https://help.ads.roku.com/en/articles/11321752#h_044875a0f6\" target\u003d\"_blank\"\u003eLearn more\u003c/a\u003e about customer parameters."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const createQueue = require('createQueue');
const callInWindow = require('callInWindow');
const aliasInWindow = require('aliasInWindow');
const copyFromWindow = require('copyFromWindow');
const localStorage = require('localStorage');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');

function bootstrap() {
  let rkp = copyFromWindow("rkpTrigger");
  if (rkp) {
    return rkp;
  }
  setInWindow("rkpTrigger", function() {
    const callMethod = copyFromWindow("rkp");
    if (callMethod) {
      callInWindow("rkp.apply", null, arguments);
    } else {
      callInWindow("rkpqueue.push", arguments);
    }
  });
  return copyFromWindow("rkpTrigger");
}

function trigger() {
  let existingRkp = copyFromWindow("rkpTrigger");
  let rkp = bootstrap();
  createQueue("rkpqueue");
  rkp("init", data.event_group_id);
  rkp("event", data.event_type, data);
  if (!existingRkp) {
    var url = "https://cdn.ravm.tv/ust/dist/rkp.initiator.gtm.js";
    injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
  }
}

trigger();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkpTrigger"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkp.eventProcessor"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkpqueue.push"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkpqueue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkp"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rkp.apply"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.ravm.tv/ust/dist/rkp.initiator.gtm.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 25/04/2025, 13:46:56


